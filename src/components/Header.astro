---
import { getCollection } from 'astro:content';

const prayers = await getCollection('prayers');
const mysteries = await getCollection('mysteries');

const sortedPrayers = prayers.sort((a, b) => (a.data.order || 99) - (b.data.order || 99));
const sortedMysteries = mysteries.sort((a, b) => (a.data.order || 99) - (b.data.order || 99));
---

<header class="site-header" role="banner">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">
      <!-- Traditional Catholic crucifix SVG -->
      <svg class="site-crucifix" width="24" height="24" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg" aria-label="Traditional Catholic crucifix">
        <rect x="47" y="20" width="6" height="100" fill="#8B4513"/>
        <rect x="20" y="45" width="60" height="4" fill="#8B4513"/>
        <rect x="35" y="25" width="30" height="3" fill="#8B4513"/>
        <path d="M50 35c-2 0-4 1-4 3v8c0 2 2 3 4 3s4-1 4-3v-8c0-2-2-3-4-3zm0 15c-1 0-2 1-2 2v5c0 1 1 2 2 2s2-1 2-2v-5c0-1-1-2-2-2zm-3-12h6c1 0 2-1 2-2s-1-2-2-2h-6c-1 0-2 1-2 2s1 2 2 2z" 
              fill="#8B4513" opacity="0.8"/>
      </svg>
      <span class="site-title-text">Rosary Prayers</span>
    </a>

    <nav class="site-nav">
      <div class="trigger">
        <div class="nav-dropdown">
          <button class="page-link dropdown-toggle" type="button" aria-expanded="false">Prayers</button>
          <div class="dropdown-content" role="menu">
            {sortedPrayers.map((prayer) => (
              <a href={`/prayers/${prayer.slug}`} role="menuitem">{prayer.data.title}</a>
            ))}
          </div>
        </div>
        
        <div class="nav-dropdown">
          <button class="page-link dropdown-toggle" type="button" aria-expanded="false">Mysteries</button>
          <div class="dropdown-content" role="menu">
            {sortedMysteries.map((mystery) => (
              <a href={`/mysteries/${mystery.slug}`} role="menuitem">{mystery.data.title}</a>
            ))}
          </div>
        </div>
      </div>
    </nav>
  </div>
  <script>
    (function () {
      const dropdowns = document.querySelectorAll('.nav-dropdown');

      function closeAll() {
        dropdowns.forEach((dropdown) => {
          dropdown.classList.remove('is-open');
          const toggle = dropdown.querySelector('.dropdown-toggle');
          if (toggle) {
            toggle.setAttribute('aria-expanded', 'false');
          }
        });
      }

      dropdowns.forEach((dropdown) => {
        const toggle = dropdown.querySelector('.dropdown-toggle');
        if (!toggle) return;

        toggle.addEventListener('click', (event) => {
          event.stopPropagation();
          const isOpen = dropdown.classList.contains('is-open');
          closeAll();
          if (!isOpen) {
            dropdown.classList.add('is-open');
            toggle.setAttribute('aria-expanded', 'true');
          }
        });
      });

      document.addEventListener('click', (event) => {
        if (!event.target.closest('.nav-dropdown')) {
          closeAll();
        }
      });

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeAll();
        }
      });
    })();
  </script>
</header>
